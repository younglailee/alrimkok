<?php/** * 관리자 > 공지사항 모듈 클래스 * @file    NoticeAdmin.class.php * @author  Alpha-Edu * @package board */namespace sFramework;class NoticeAdmin extends Notice{    protected function setBoardConfig()    {        parent::setBoardConfig();        $bd_code = $this->get('bd_code');        // 알파클라우드 게시판: 작성일 수동 기능 해제        if ($bd_code == 'cloud') {            $this->set('flag_use_reg', false);        }    }    public function checkViewAuth($data)    {        return true;    }    public function checkWriteAuth()    {        return true;    }    public function checkUpdateAuth($uid)    {        return true;    }    /**     * 리스트 권한 검사 wkkim 180424     * @return bool     */    public function checkListAuth()    {        global $member;        $mb_auth_code_arr = explode('|', $member['mb_auth_codes']);        // 최고관리자 모든 권한 부여        if ($member['mb_level'] == 10) {            return true;        }        // 지정된 권한이 아닐 경우 리스트 조회를 막음        $bd_code = $_GET['bd_code'];        if ($bd_code == 'receipt') {            if (!in_array($bd_code, $mb_auth_code_arr)) {                return false;            }        }        return true;    }    public function initInsert()    {        global $oBoard;        parent::initInsert();        $bd_code = $oBoard->get('bd_code');        if ($bd_code == 'article') {            $this->set('return_uri', './write.html');        }        $live = $_POST['live'];        $book = $_POST['book'];        if($live == 'reference'){            $this->set('return_uri', './reference_list.html');        }        if($book == 'reference'){            $this->set('return_uri', './reference_list.html');        }        $this->set('flag_use_category', true);    }    protected function initUpdate()    {        global $oBoard;        parent::initUpdate();        $bd_code = $oBoard->get('bd_code');        if ($bd_code == 'article') {            $this->set('return_uri', './write.html');        }        $live = $_POST['live'];        $book = $_POST['book'];        if($live == 'reference'){            $this->set('return_uri', './reference_list.html');        }        if($book == 'reference'){            $this->set('return_uri', './reference_list.html');        }    }    protected function initDelete()    {        $this->set('fi_module', $this->get('module'));        $this->set('return_uri', './list.html');        $this->set('success_msg', '정상적으로 삭제하였습니다.');        $live = $_POST['live'];        $book = $_POST['book'];        if($live == 'reference'){            $this->set('return_uri', './reference_list.html');        }        if($book == 'reference'){            $this->set('return_uri', './reference_list.html');        }    }    public function recruitList()    {        $db_where = "WHERE bd_code = 'recruit'";        $list = Db::select('tbl_board', '*', $db_where, "", "");        return $list;    }    protected function makeDbWhere()    {        $db_where = parent::makeDbWhere();        $bd_code = $this->get('bd_code');        $live = $this->get('live');        $book = $this->get('book');        if ($bd_code) {            //$db_where .= " AND bd_code = '$bd_code' ";            if ($bd_code == 'reference') {                if($live == 'reference'){                    $db_where .= " AND bd_category='live'";                }                if($book == 'reference'){                    $db_where .= " AND bd_category='book'";                } else {                    // 북러닝 환급 제외 yllee 241011                    $db_where .= " AND (bd_category!='book' OR bd_category IS NULL)";                }            }        }        // 북러닝(비환급) 구분 yllee 240516        $read = $this->get('read');        if($read == 'reference'){            $db_where .= " AND bd_category = 'read'";        }        $sch_s_date = $_GET['sch_s_date'];        $sch_e_date = $_GET['sch_e_date'];        $sch_bd_auth = $_GET['sch_bd_auth'];        if ($sch_e_date && $sch_s_date) {            $db_where .= " AND reg_time >= '$sch_s_date 00:00:00' AND reg_time <= '$sch_e_date 23:59:59'";        }        if ($sch_bd_auth == 'admin') {            $db_where .= " AND bd_etc3 != 'Y' AND bd_etc6 != 'Y' AND bd_etc9 != 'Y'";        } elseif ($sch_bd_auth == 'partner') {            $db_where .= " AND bd_etc3 = 'Y'";        } elseif ($sch_bd_auth == 'tutor') {            $db_where .= " AND bd_etc6 = 'Y'";        } elseif ($sch_bd_auth == 'company') {            $db_where .= " AND bd_etc9 = 'Y'";        }        $this->set('db_where', $db_where);        //echo $db_where;        //Log::debug($db_where);        return $db_where;    }}